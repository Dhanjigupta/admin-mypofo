var box=null, alertbox=null;
function Wait(html) {
	box=bootbox.dialog({ 
    size: 'small',
    closeButton: false,
    message: "<center><img src='./images/ajax-loader.gif' alt='ajax-loader' hight=15px width=15px>&nbsp;&nbsp;" + html + "</center>" 
    }).css({'top':'27%'}); 
}
function Waiting(html) {
	box=bootbox.dialog({ 
    size: 'small',
    closeButton: false,
    message: "<center><img src='./images/ajax-loader.gif' alt='ajax-loader' hight=15px width=15px>&nbsp;&nbsp;" + html + "</center>" 
    }).css({'top':'27%'}); 
}
function alertBox(html,control){
    alertbox = bootbox.alert({
        backdrop:true,
        title:'Information',
        message:html,
    }).css({'top':'10%'}); 
    $('.bootbox').on('hidden.bs.modal', function() { 
        $(control).focus();
    });
}
function messageBox(html){
    bootbox.alert({
        title:'Information',
        message:html,
    });
    $('.bootbox').on('hidden.bs.modal', function() { 
        getData('page');
    });
}
function simpleMessage(html){
    bootbox.alert({
        title:'Information',
        message:html,
    });
    
}
function warning(){
    bootbox.alert({
        title:'Information',
        message:'You are not authorised to do this action:',
    });
}
function unauthorizeBox(){
    bootbox.alert({
        title:'Information',
        message:'You are not authorized to add record:<br>Please contact your administrator:',
    });
    $('.bootbox').on('hidden.bs.modal', function() { 
        getData('page');
    });
}
$('#selectall,#selectallf').change(function(){
    var cha=$('input:checkbox[name=row]');
    for(i=0;i<cha.length;i++){
        if(!cha[i].disabled){
           cha[i].checked=$(this).is(':checked');
        }
    }
});
function showParentModal(params,btnvalue){
    if(btnvalue)
    $('#btnSave').html(btnvalue.split("..").join(' '));
    $('#checkcompleteaction').val("-1");
    $('#eachid').val(params[0].eachid);
    $('#MyModal').data('width',params[0].w);
    $('#MyModal').data('height',params[0].h);
    $('#MyModal').modal("show");
    $('#MyModal').on("shown.bs.modal",function(){$('input:text:visible:first', this).focus();});
    $('#ModalTitle').html(params[0].title.split("..").join(' '));
    $('#LoaderMessage').html('Loading........please wait');
    $('#Loader').toggle();
    $('#ModalBody').html('');
    $('#MyModal').on('hidden.bs.modal',parentResetMessage);
    $.post(params[0].formurl,{EachId:params[0].eachid,Arg1:params[0].arg1,Arg2:params[0].arg2},function(resp) {
        $('#Loader').toggle();
        $('#ModalBody').html(resp);
        $("#btnSave").attr("onclick",params[0].method);
    });
}
function parentResetMessage(){
    $('#btnSave').html('Save Changes');
    $('#Loader').css({"display":"none"});
    $('#divMessage').html('');
    $('#LoaderMessage').html('');
    $('#ModalBody').html('');
    if($('#checkcompleteaction').val()==1)
        getData('page');
}
function showParentModalLibrary(params){
    $('#eachid').val(params[0].eachid);
    $('#MyModal').data('width',params[0].w);
    $('#MyModal').data('height',params[0].h);
    $('#MyModal').modal("show");
    $('#MyModal').on("shown.bs.modal",function(){$('input:text:visible:first', this).focus();});
    $('#ModalTitle').html(params[0].title.split("..").join(' '));
    $('#LoaderMessage').html('Loading........please wait');
    $('#Loader').toggle();
    $('#ModalBody').html('');
    $('#MyModal').on('hidden.bs.modal',parentResetMessageLibrary);
    $.post(params[0].formurl,{EachId:params[0].eachid},function(resp) {
        $('#Loader').toggle();
        $('#ModalBody').html(resp);
        $("#btnSave").attr("onclick",params[0].method);
    });
}
function parentResetMessageLibrary(){
    $('#btnSave').html('Save Changes');
    $('#Loader').css({"display":"none"});
    $('#divMessage').html('');
    $('#LoaderMessage').html('');
    $('#ModalBody').html('');
    getData('page');
}
function showChildModal(params){
    $('#ChildMyModal').data('width',params[0].w);
    $('#ChildMyModal').data('height',params[0].h);
    $('#ChildMyModal').modal("show");
    $('#ChildMyModal').on("shown.bs.modal",function(){$('input:text:visible:first', this).focus();});
    $('#ChildModalTitle').html(params[0].title.split("..").join(' '));
    $('#ChildLoaderMessage').html('Loading......please wait');
    $('#ChildLoader').toggle();
    $('#ChildModalBody').html('');
    $('#ChildMyModal').on('hidden.bs.modal',childResetMessage);
    $.post(params[0].formurl,function(resp) {
        $('#ChildLoader').toggle();
        $('#ChildModalBody').html(resp);
        $("#childbtnSave").attr("onclick",params[0].method);
    });
}
function childResetMessage(){
    $('#ChildLoader').css({"display":"none"});
    $('#divMessageChild').html('');
    $('#ChildLoaderMessage').html('');
    $('#ChildModalBody').html('');
}
function showStepModal(params){
    $('#stepModalBody').removeClass('modal-body');
    $('#stepModalBody').addClass('modal-body');
    $('#checkcompleteaction').val("-1");
    $('#showmodalfor').val(params[0].showmodalfor);
    $('#eachid').val(params[0].eachid);
    $('#stepMyModal').data('width',params[0].w);
    $('#stepMyModal').data('height',params[0].h);
    $('#stepMyModal').modal("show");
    $('#stepLoaderMessage').html('Loading........please wait');
    $('#stepLoader').toggle();
    $('#stepModalBody').html('');
    $('#stepMyModal').on('hidden.bs.modal',stepResetMessage);
    $.post(params[0].formurl,{EachId:params[0].eachid},function(resp) {
        $('#stepLoader').toggle();
        $('#stepModalBody').removeClass('modal-body');
        $('#stepModalBody').html(resp);
    });
}
function stepResetMessage(){
    $('#stepLoader').css({"display":"none"});
    $('#divMessageStep').html('');
    $('#stepLoaderMessage').html('');
    $('#stepModalBody').html('');
    if($('#checkcompleteaction').val()==1)
        getData('page');
}
function showDetailsModal(params){
    $('#eachid').val(params[0].eachid);
    $('#DetailsMyModal').data('width',params[0].w);
    $('#DetailsMyModal').data('height',params[0].h);
    $('#DetailsMyModal').modal("show");
    $('#DetailsModalTitle').html(params[0].title.split("..").join(' '));
    $('#DetailsLoaderMessage').html('Loading........please wait');
    $('#DetailsLoader').toggle();
    $('#DetailsModalBody').html('');
    $('#DetailsMyModal').on('hidden.bs.modal',detailsResetMessage);
    $.post(params[0].formurl,{EachId:params[0].eachid},function(resp) {
        $('#DetailsLoader').toggle();
        if(resp==-1)
            $('#DetailsModalBody').html("<div class='text-danger text-center'><h3>There is no record found:</h3></div>");
        else{            
            $('#DetailsModalBody').html(resp);
            showDetails(params[0].eachid);
        }
    });
}
function detailsResetMessage(){
    $('#Loader').css({"display":"none"});
    $('#divMessage').html('');
    $('#LoaderMessage').html('');
    $('#DetailsModalBody').html('');
}
var specialKeys = new Array();
var ret;
specialKeys.push(8); //Backspace
function isNumeric(e,inputdata){
    var keyCode = e.which ? e.which : e.keyCode
    var ilength=inputdata.length;
    ret = ((keyCode >= 48 && keyCode <= 57) || specialKeys.indexOf(keyCode) != -1);
    return ret;
}
function isRating(e,inputdata){
    var keyCode = e.which ? e.which : e.keyCode
    var ilength=inputdata.length;
    ret = ((keyCode >= 49 && keyCode <= 53) || specialKeys.indexOf(keyCode) != -1);
    return ret;
}
function isDecimal(e,inputdata){
    var keyCode = e.which ? e.which : e.keyCode
    ret = ((keyCode >= 48 && keyCode <= 57)||(keyCode==46)|| specialKeys.indexOf(keyCode) != -1);
    return ret;
}
function isCoupon(e,inputdata){
    var keyCode = e.which ? e.which : e.keyCode
    ret = ((keyCode >= 48 && keyCode <= 57)||(keyCode >= 97 && keyCode <= 122)||(keyCode >= 65 && keyCode <= 91)||(keyCode == 45)|| specialKeys.indexOf(keyCode) != -1);
    return ret;
}
function isAddress(e,inputdata){
    var keyCode = e.which ? e.which : e.keyCode
    ret = ((keyCode >= 48 && keyCode <= 57)||(keyCode >= 97 && keyCode <= 122)||(keyCode >= 65 && keyCode <= 91)||(keyCode == 45)||(keyCode == 44)||(keyCode == 32)||(keyCode == 47)||(keyCode == 46)|| specialKeys.indexOf(keyCode) != -1);
    return ret;
}
function isString(e,inputdata){
    var keyCode = e.which ? e.which : e.keyCode
    var ilength=inputdata.length;
    if(ilength<1)
        ret = ((keyCode >= 65 && keyCode <= 91)|| (keyCode >= 97 && keyCode <= 122)|| specialKeys.indexOf(keyCode) != -1);
    else
        ret = ((keyCode >= 65 && keyCode <= 91)|| (keyCode >= 97 && keyCode <= 122)||(keyCode==32)|| specialKeys.indexOf(keyCode) != -1);
    return ret;
}
function isMobile(e,inputdata){
    var keyCode = e.which ? e.which : e.keyCode
    var ilength=inputdata.length;
    if(ilength>10){
        ret=false;
        return ret;
    }
    if(ilength<1)
        ret = ((keyCode >= 55 && keyCode <= 57)|| specialKeys.indexOf(keyCode) != -1);
    else
        ret = ((keyCode >= 48 && keyCode <= 57)|| specialKeys.indexOf(keyCode) != -1);
    return ret;
}
function isCustomerId(e,inputdata) {
   var keyCode = e.which ? e.which : e.keyCode
   var ilength=inputdata.length;
   if(ilength<1)
        ret = ((keyCode >= 49 && keyCode <= 57)|| specialKeys.indexOf(keyCode) != -1);
   else
        ret = ((keyCode >= 48 && keyCode <= 57)||(keyCode==13)||(keyCode==44)||(keyCode==32)|| specialKeys.indexOf(keyCode) != -1);
   return ret;
}
function generateCode(id){
    $('#'+id).keyup(function(){
        var pname=$(this).val().split(' ');
        str=pname[0].charAt(0);
        for(var i=1;i<pname.length;i++){
            str+=pname[i].charAt(0);
        }
        $('#code').val(str); 
    });
}
function validate(params){
    for(var i=0;i<params.length;i++){
        if($('#'+params[i].id).val()==params[i].value ||($('#'+params[i].id).val()==null && params[i].type=="select")){
            $('#'+params[i].id).parent().addClass("has-error");
            alertBox(params[i].message,'#'+params[i].id);
            return false;
        }
        else{
            $('#'+params[i].id).parent().removeClass("has-error").addClass("has-success");
        }
        if(params[i].type=='email'){
            var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
            if($('#'+params[i].id).val()!=params[i].value && !reg.test($('#'+params[i].id).val())){
                $('#'+params[i].id).parent().addClass("has-error");
                alertBox("Email is not valid:",'#'+params[i].id);
                return false;
            }
            else{
                $('#'+params[i].id).parent().removeClass("has-error").addClass("has-success");
            }
        
        }
        else if(params[i].type=="confirm"){
            if($('#'+params[i-1].id).val()!=$('#'+params[i].id).val()){
                $('#'+params[i].id).parent().addClass("has-error");
                alertBox("Confirm password does not match:",'#'+params[i].id);
                return false;
            }
            else{
                $('#'+params[i].id).parent().removeClass("has-error").addClass("has-success");
            }    
            
        }
       else if(params[i].type=="check"){
            if(!$('#'+params[i].id).is(":checked")){
                $('#'+params[i].id).parent().addClass("has-error");
                alertBox("Check i agree to terms and services:",'#'+params[i].id);
                return false;
            }
            else{
                $('#'+params[i].id).parent().removeClass("has-error").addClass("has-success");
            }    
        }
       else if(params[i].type=="mobile"){
            if($('#'+params[i].id).val().length<10){
                $('#'+params[i].id).parent().addClass("has-error");
                alertBox("Mobile number must be 10 digits number:",'#'+params[i].id);
                return false;
            }
            else{
                $('#'+params[i].id).parent().removeClass("has-error").addClass("has-success");
            }    
            
        }
       else if(params[i].type=="checkm"){
            var vals = [];
            $('input:checkbox[name="'+params[i].id+'[]"]').each(function(){
                if (this.checked) {
                    vals.push(this.value);
                } 
            });
            if(vals.length==0){
                $('input:checkbox[name="'+params[i].id+'[]"]').parent().addClass("has-error");
                alertBox(params[i].message,$('input:checkbox[name="'+params[0].id+'[]"]'));
                return false;
            }
            else{
                $('input:checkbox[name="'+params[i].id+'[]"]').parent().removeClass("has-error").addClass("has-success");
            }    
       }
       else if(params[i].type=="radio"){
            vals = [];
            $('input:radio[name="'+params[i].id+'[]"]').each(function(){
                if (this.checked) {
                    vals.push(this.value);
                } 
            });
            if(vals.length==0){
                $('input:radio[name="'+params[i].id+'[]"]').parent().addClass("has-error");
                alertBox(params[i].message,$('input:radio[name="'+params[i].id+'[]"]'));
                return false;
            }
            else{
                $('input:radio[name="'+params[i].id+'[]"]').parent().removeClass("has-error").addClass("has-success");
            }    
       }
       else if(params[i].type=="other"){
            if($('#'+params[i].id).val()=="" && params[i].value<-1){
                $('#'+params[i].id).parent().addClass("has-error");
                alertBox(params[i].message,'#'+params[i].id);
                return false;
            }
            else{
                $('#'+params[i].id).parent().removeClass("has-error").addClass("has-success");
            }    
            
        }
    }
    return true;
}
function EDDSingle(pagename,text,table,column,message,value,isdeleted){
    if(pagename.indexOf('restore')==-1 && pagename.indexOf('delete')==-1){
        if(isdeleted==1){
            simpleMessage('Trash record can not be '+text+'.<br>Doing this restore this record.');
            return false;
        }
    }
    text=text.replace(/AVGHUI/g," ");
    bootbox.confirm('Are you sure to '+text+' this record?\nId : '+value, function(result) {
        if(result==true){
            $.ajax({
                url:'status/'+pagename,
                type: "POST",data:{'table':table,'column':column,'message':message,'value':value},
                success: function(res){
                messageBox(res);},       
                error: function(res) {}
            });
        }
    }).css({'top':'27%'});
}
function EDDMultiple(pagename,text,table,column,message,check){
    text=text.replace(/AVGHUI/g," ");
    var count=0;
    if(check!="")
        var ch=document.getElementsByName(check);
    else
        var ch=document.getElementsByName('row');
    for(i=0;i<ch.length;i++){
        if(ch[i].checked)
          count++;  
    }
    if(count==0)
        alertBox('Please Select a Record:','#selectall');
    else{
        var val="";
        for(i=0;i<ch.length;i++){
            if(ch[i].checked)
                val=val+", "+ch[i].value;
        }
        val =val.substring(1,val.length);
        bootbox.confirm('Are you sure to '+text+' these record?', function(result) {
        if(result==true){
            $.ajax({
                url:'status/'+pagename,
                type: "POST",data:{'table':table,'column':column,'message':message,'value':val},
                success: function(res){
                messageBox(res);},       
                error: function(res) {}
            });
        }
        }).css({'top':'27%'});
         
    }
}

function excel(url){
    bootbox.confirm('Are you sure to download these record?', function(result) {
        if(result==true){
            phpForm.action=url;
            phpForm.submit();
        }
    }).css({'top':'27%'});    
}
function AddEmailSMS(params){
    var count=0;
    var ch=$('input:checkbox[name="row"]');
    for(i=0;i<ch.length;i++){
        if(ch[i].checked)
          count++;  
    }
    if(count==0){
        bootbox.confirm('Please Select a Record otherwise all records will be added to list:',function(result){
            if(result==true){
                return;
            }
            else{
                $('#assignid').val($('#userid').val());
                showParentModal(params);
            }
        });
     
    }
    else{
        var val="";
        for(i=0;i<ch.length;i++){
            if(ch[i].checked)
                val=val+", "+ch[i].value;
        }
        val=val.substring(1,val.length);
        $('#assignid').val(val);
        showParentModal(params);
    }
}

function uploadRecords(){
    bootbox.confirm("Are you sure to upload these record?", function(result){
        if(result==true){
            $('#Loader').toggle();
            $('#LoaderMessage').html('Uploading records.......please wait');
            data={'for':$('#import').val()};
            $.post("data.import.php",data,
                function(res){
                    $('#Loader').toggle();
                    $('#divMessage').html(res);
                    getData('page');
                }
            );
        }
    }).css({'top':'27%'});
}

function EDRTVU(pagename,text,table,column,message,value,isdeleted){
    if(pagename.indexOf('restore')==-1 && pagename.indexOf('trash')==-1){
        if(isdeleted==1){
            simpleMessage('Trash record can not be '+text+'.<br>Doing this restore this record.');
            return false;
        }
    }
    text=text.replace(/AVGHUI/g," ");
    $.ajax({
        url:'status/'+pagename,
        type: "POST",data:{'table':table,'column':column,'message':message,'value':value},
        success: function(res){
            arr=res.split('$');
            if(arr[1]=="-1")
               simpleMessage(res);  
            else
                getData('page');    
        },       
        error: function(res) {}
    });
}

function showTrash(url){
    window.open(url,'Trash','');
}
function show(url){
    window.open(url);
}

function addRecords(params,page,message){
    if(validate(params)){
        bootbox.confirm("Are you sure to add this record?", function(result) {
            if(result==true){
                $('#Loader').toggle();
                $('#LoaderMessage').html('Saving '+message+'.......please wait');
                $.post("phppages/"+page,$('#AddForm').serialize(),
                    function(res){
                        $('#Loader').toggle();
                        $('#divMessage').html(res);
                        $('#checkcompleteaction').val("1");       
                    }
                );
            } 
        }).css({'top':'27%'});       
    }
}

function editRecords(params,page,column){
    if(validate(params)){
        bootbox.confirm("Are you sure to edit this record?", function(result) {
            if(result==true){
                $('#Loader').toggle();
                $('#LoaderMessage').html('Saving changes.......please wait');
                data=$('#EditForm').serializeArray();
                data.push({name:column,value:$('#eachid').val()})
                $.post("phppages/"+page,
                    data,
                    function(res){
                        $('#Loader').toggle();
                        $('#divMessage').html(res);
                        $('#checkcompleteaction').val("1");
                    }       
                );
            }
        }).css({'top':'27%'}); 
    }    
}
function inputLimiter(control,e,allow) {
    	var AllowableCharacters = '';
		if (allow == 'Letters'){AllowableCharacters=' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';}
    	if (allow == 'Numbers'){AllowableCharacters='1234567890';}
        if (allow == 'CharAndNumber'){AllowableCharacters='abcdefghijklmnopqrstuvwxyz1234567890';}
        
		if (allow == 'Mobile') {
			AllowableCharacters='1234567890';
			Mobile = control.value;
			if (Mobile.length < 1){AllowableCharacters='6789';}
			if (Mobile.length > 9){AllowableCharacters='';}
		}
        if (allow == 'Quantity') {
			AllowableCharacters='1234567890';
			Mobile = control.value;
			if (Mobile.length < 1){AllowableCharacters='123456789';}
			if (Mobile.length > 9){AllowableCharacters='';}
		}
		if (allow == 'Draft' || allow == 'PINCode') {
			AllowableCharacters='1234567890';
			Str6 = control.value;
			if (Str6.length > 5){AllowableCharacters='';}	
		}
        if (allow == 'VerificationCode8Digit') {
			AllowableCharacters='1234567890'
			CVCode = control.value;
			if(CVCode.length > 7 ) {AllowableCharacters='';}
		}
        
    	if (allow == 'Name'){AllowableCharacters=' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz.'}
    	if (allow == 'NameCharactersAndNumbers'){AllowableCharacters='1234567890 ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-\'';}
		var k = document.all?parseInt(e.keyCode): parseInt(e.which);
		if (allow == 'BirthDate') {
			AllowableCharacters='1234567890';
			var myDate = control.value;
			if (myDate.length > 1){AllowableCharacters='';}
			if (myDate == '0'){AllowableCharacters='123456789';}
            if (myDate == 1){AllowableCharacters='1234567890';}
            if (myDate == 2){AllowableCharacters='1234567890';}
			if (myDate == 3){AllowableCharacters='01';}
            if(myDate.length==1 && myDate>3){
                AllowableCharacters='';
            }
		}
        if (allow == 'Year') {
			AllowableCharacters='1234567890';
			year = control.value;
			if (year.length < 1){AllowableCharacters='12';}
			if (year.length > 3){AllowableCharacters='';}
		}
		if (allow == 'BirthMonth') {
			AllowableCharacters='1234567890';
			var myMonth = control.value;
			if (myMonth.length > 1){AllowableCharacters='';}
			if (myMonth =='0'){AllowableCharacters='123456789';}
			if (myMonth== 1){AllowableCharacters='012';}
             if(myMonth.length==1 && myMonth>=2){
                AllowableCharacters='';
            }
		}
		if (allow == 'BirthYear') {
			AllowableCharacters='1234567890';
			year = control.value;
			if (year.length < 1){AllowableCharacters='12';}
			if (year.length > 3){AllowableCharacters='';}
			if (year == '1'){AllowableCharacters='9';}
			if (year == '19'){AllowableCharacters='789';}
			if (year == '197'){AllowableCharacters='0123456789';}
			if (year == '2' || year == '20' || year == '200'){AllowableCharacters='0';}
		}
		if (allow == 'Marks') {
			AllowableCharacters='1234567890.';
			marks = control.value;
			if (marks.length < 1){AllowableCharacters='123456789';}
			if (marks*1 >= 10){AllowableCharacters='0';}
			if (marks*1 >= 11){AllowableCharacters='';}
			if (marks.length > 2){AllowableCharacters='';}
		}
		//regExpr = /^[789][0-9]{9}$/;
   		//if(!regExpr.test(sourceFieldValue))
    	if (k!=13 && k!=8 && k!=0)
			{
        		return (AllowableCharacters.indexOf(String.fromCharCode(k))!=-1);
    		} 
		else 
			{
		        return true;
    		}
	}





